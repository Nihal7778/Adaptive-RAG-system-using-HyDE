<png viewBox="0 0 1400 1000" xmlns="http://www.w3.org/2000/png">
  <!-- Title -->
  <text x="700" y="40" font-size="32" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    AdaptiveRAG System Architecture
  </text>
  
  <!-- User Layer -->
  <rect x="600" y="80" width="200" height="60" fill="#3498db" rx="8"/>
  <text x="700" y="115" font-size="18" font-weight="bold" text-anchor="middle" fill="white">üë§ User Interface</text>
  
  <!-- UI Components -->
  <rect x="250" y="180" width="180" height="50" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="340" y="210" font-size="14" text-anchor="middle" fill="#2c3e50">Document Selector</text>
  
  <rect x="460" y="180" width="180" height="50" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="550" y="210" font-size="14" text-anchor="middle" fill="#2c3e50">HyDE Toggle</text>
  
  <rect x="670" y="180" width="180" height="50" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="760" y="210" font-size="14" text-anchor="middle" fill="#2c3e50">Chat Interface</text>
  
  <rect x="880" y="180" width="180" height="50" fill="#ecf0f1" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="970" y="210" font-size="14" text-anchor="middle" fill="#2c3e50">Upload/Delete Docs</text>
  
  <!-- Arrow to Flask -->
  <path d="M 700 140 L 700 180" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 700 230 L 700 270" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Flask API Layer -->
  <rect x="550" y="270" width="300" height="70" fill="#27ae60" rx="8"/>
  <text x="700" y="295" font-size="20" font-weight="bold" text-anchor="middle" fill="white">Flask API Server</text>
  <text x="700" y="320" font-size="14" text-anchor="middle" fill="white">Routes: /get, /get_hyde, /upload, /delete, /reindex</text>
  
  <!-- Memory Component -->
  <rect x="900" y="280" width="220" height="50" fill="#f39c12" rx="5"/>
  <text x="1010" y="310" font-size="14" font-weight="bold" text-anchor="middle" fill="white">üß† Conversation Memory</text>
  <text x="1010" y="325" font-size="11" text-anchor="middle" fill="white">BufferWindowMemory (k=5)</text>
  
  <!-- Arrow to Retrieval -->
  <path d="M 700 340 L 700 380" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Retrieval Mode Decision -->
  <polygon points="700,380 820,430 700,480 580,430" fill="#e74c3c"/>
  <text x="700" y="430" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Retrieval Mode?</text>
  
  <!-- Baseline Path -->
  <path d="M 580 430 L 400 430" stroke="#3498db" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="490" y="420" font-size="14" fill="#3498db" font-weight="bold">Baseline</text>
  
  <rect x="200" y="500" width="200" height="70" fill="#3498db" rx="8"/>
  <text x="300" y="525" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Baseline Retrieval</text>
  <text x="300" y="545" font-size="12" text-anchor="middle" fill="white">Direct query embedding</text>
  <text x="300" y="560" font-size="12" text-anchor="middle" fill="white">‚è±Ô∏è Fast (1.35s)</text>
  
  <!-- HyDE Path -->
  <path d="M 820 430 L 1000 430" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="910" y="420" font-size="14" fill="#e74c3c" font-weight="bold">HyDE</text>
  
  <rect x="1000" y="500" width="200" height="70" fill="#e74c3c" rx="8"/>
  <text x="1100" y="525" font-size="16" font-weight="bold" text-anchor="middle" fill="white">HyDE Retrieval</text>
  <text x="1100" y="545" font-size="12" text-anchor="middle" fill="white">1. Generate hypothesis</text>
  <text x="1100" y="560" font-size="12" text-anchor="middle" fill="white">2. Embed & search</text>
  
  <!-- Arrows to Pinecone -->
  <path d="M 300 570 L 300 620 L 600 620" stroke="#3498db" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 1100 570 L 1100 620 L 800 620" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Pinecone Vector Store -->
  <rect x="600" y="600" width="200" height="80" fill="#9b59b6" rx="8"/>
  <text x="700" y="630" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Pinecone Vector DB</text>
  <text x="700" y="650" font-size="12" text-anchor="middle" fill="white">5,860+ chunks</text>
  <text x="700" y="665" font-size="12" text-anchor="middle" fill="white">384-dim embeddings</text>
  
  <!-- Document Filter -->
  <rect x="420" y="610" width="160" height="40" fill="#f39c12" rx="5"/>
  <text x="500" y="635" font-size="12" font-weight="bold" text-anchor="middle" fill="white">üìÅ Doc Filter (doc_id)</text>
  
  <!-- Arrow to LLM -->
  <path d="M 700 680 L 700 730" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- LLM Generation -->
  <rect x="550" y="730" width="300" height="80" fill="#16a085" rx="8"/>
  <text x="700" y="760" font-size="20" font-weight="bold" text-anchor="middle" fill="white">GPT-4o-mini Generation</text>
  <text x="700" y="780" font-size="13" text-anchor="middle" fill="white">Temperature: 0.0 | Max tokens: 800</text>
  <text x="700" y="798" font-size="13" text-anchor="middle" fill="white">System Prompt: Strict medical grounding</text>
  
  <!-- Arrow to Response -->
  <path d="M 700 810 L 700 860" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Response -->
  <rect x="550" y="860" width="300" height="80" fill="#2ecc71" rx="8"/>
  <text x="700" y="890" font-size="18" font-weight="bold" text-anchor="middle" fill="white">üì§ Response</text>
  <text x="700" y="910" font-size="13" text-anchor="middle" fill="white">Answer + Sources + Hypothesis (if HyDE)</text>
  <text x="700" y="928" font-size="13" text-anchor="middle" fill="white">Stored in conversation memory</text>
  
  <!-- Side Panel: Data Processing -->
  <rect x="50" y="270" width="140" height="400" fill="#34495e" rx="8"/>
  <text x="120" y="295" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Data Pipeline</text>
  
  <rect x="60" y="310" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="120" y="337" font-size="11" text-anchor="middle" fill="#2c3e50">PDF Upload</text>
  
  <path d="M 120 355 L 120 370" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="60" y="370" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="120" y="397" font-size="11" text-anchor="middle" fill="#2c3e50">Text Splitting</text>
  
  <path d="M 120 415 L 120 430" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="60" y="430" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="120" y="457" font-size="11" text-anchor="middle" fill="#2c3e50">Embedding</text>
  
  <path d="M 120 475 L 120 490" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="60" y="490" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="120" y="517" font-size="11" text-anchor="middle" fill="#2c3e50">Metadata Tagging</text>
  
  <path d="M 120 535 L 120 550" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="60" y="550" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="120" y="577" font-size="11" text-anchor="middle" fill="#2c3e50">Store in Pinecone</text>
  
  <path d="M 180 592 L 600 640" stroke="#9b59b6" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- Side Panel: Deployment -->
  <rect x="1210" y="270" width="140" height="400" fill="#34495e" rx="8"/>
  <text x="1280" y="295" font-size="14" font-weight="bold" text-anchor="middle" fill="white">CI/CD Pipeline</text>
  
  <rect x="1220" y="310" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="1280" y="337" font-size="11" text-anchor="middle" fill="#2c3e50">GitHub Push</text>
  
  <path d="M 1280 355 L 1280 370" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="1220" y="370" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="1280" y="397" font-size="11" text-anchor="middle" fill="#2c3e50">Build Docker</text>
  
  <path d="M 1280 415 L 1280 430" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="1220" y="430" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="1280" y="457" font-size="11" text-anchor="middle" fill="#2c3e50">Push to ECR</text>
  
  <path d="M 1280 475 L 1280 490" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="1220" y="490" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="1280" y="517" font-size="11" text-anchor="middle" fill="#2c3e50">Deploy to EC2</text>
  
  <path d="M 1280 535 L 1280 550" stroke="white" stroke-width="2" marker-end="url(#arrowhead-white)"/>
  
  <rect x="1220" y="550" width="120" height="45" fill="#ecf0f1" rx="4"/>
  <text x="1280" y="577" font-size="11" text-anchor="middle" fill="#2c3e50">Run Container</text>
  
  <path d="M 1220 575 L 850 305" stroke="#27ae60" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- Technology Labels -->
  <rect x="50" y="950" width="1300" height="40" fill="#2c3e50" rx="5"/>
  <text x="700" y="975" font-size="14" text-anchor="middle" fill="white">
    üîß Tech Stack: Flask ‚Ä¢ LangChain ‚Ä¢ Pinecone ‚Ä¢ OpenAI GPT-4o-mini ‚Ä¢ Docker ‚Ä¢ AWS EC2 ‚Ä¢ GitHub Actions
  </text>
  
  <!-- Legend -->
  <rect x="1150" y="80" width="200" height="150" fill="#ecf0f1" stroke="#34495e" stroke-width="2" rx="5"/>
  <text x="1250" y="105" font-size="14" font-weight="bold" text-anchor="middle" fill="#2c3e50">Key Metrics</text>
  
  <text x="1160" y="130" font-size="12" fill="#2c3e50">‚Ä¢ Faithfulness: 87.5%</text>
  <text x="1160" y="150" font-size="12" fill="#2c3e50">‚Ä¢ F1 Score: 76.7%</text>
  <text x="1160" y="170" font-size="12" fill="#2c3e50">‚Ä¢ Accuracy: 80%</text>
  <text x="1160" y="190" font-size="12" fill="#2c3e50">‚Ä¢ Memory: 5 turns</text>
  <text x="1160" y="210" font-size="12" fill="#2c3e50">‚Ä¢ Citations: 100%</text>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e"/>
    </marker>
    <marker id="arrowhead-white" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="white"/>
    </marker>
  </defs>
</png>
